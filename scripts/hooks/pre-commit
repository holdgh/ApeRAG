#!/bin/bash

# Pre-commit hook to run make lint and make add-license
# This script will be executed before each git commit

set -e  # Exit on any error

echo "Running pre-commit checks..."

# Change to the repository root directory
cd "$(git rev-parse --show-toplevel)"

# Run make lint
echo "ğŸ” Running make lint..."
if ! make lint; then
    echo "âŒ Lint check failed. Please fix the issues and try again."
    exit 1
fi
echo "âœ… Lint check passed."

# Run make add-license
echo "ğŸ“„ Running make add-license..."
if ! make add-license; then
    echo "âŒ License addition failed. Please check and try again."
    exit 1
fi
echo "âœ… License addition completed."

# Check if there are any changes after adding licenses
if ! git diff --quiet; then
    echo "ğŸ“ License headers were added to some files."
    echo "Please review the changes and commit again:"
    git status --porcelain
    exit 1
fi

echo "ğŸ‰ All pre-commit checks passed!"
exit 0 