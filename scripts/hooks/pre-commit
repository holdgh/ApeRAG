#!/bin/bash

# Pre-commit hook to run make lint and make add-license
# This script will be executed before each git commit

set -e  # Exit on any error

echo "ğŸ” Pre-commit: Running code quality checks..."

# Change to the repository root directory
cd "$(git rev-parse --show-toplevel)"

# Run make lint
echo "  â†’ make lint"
if ! make lint >/dev/null 2>&1; then
    echo "âŒ Lint check failed!"
    echo "ğŸ’¡ Run 'make format' to auto-fix issues, then commit again."
    echo ""
    echo "Detailed errors:"
    make lint
    exit 1
fi

# Run make add-license
echo "  â†’ make add-license"
if ! make add-license >/dev/null 2>&1; then
    echo "âŒ License addition failed!"
    echo "ğŸ’¡ Please check the error and try again."
    make add-license
    exit 1
fi

# Check if there are any changes after adding licenses
if ! git diff --quiet; then
    echo "ğŸ“ License headers were added to files."
    echo "ğŸ’¡ Please review changes and commit again."
    exit 1
fi

echo "âœ… Pre-commit checks passed!"
exit 0 