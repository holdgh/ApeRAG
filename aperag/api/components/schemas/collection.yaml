# collectionSource:
#   type: object
#   properties:
#     category:
#       type: string
#       enum:
#         - upload
#         - tencent
#         - oss
#         - local
#         - s3
#         - ftp
#         - email
#         - url
#         - github
#     upload:
#       type: object
#     local:
#       type: object
#       properties:
#         path:
#           type: string
#     oss:
#       type: object
#       properties:
#         access_key_id:
#           type: string
#         access_key_secret:
#           type: string
#         buckets:
#           type: array
#           items:
#             type: object
#             properties:
#               bucket:
#                 type: string
#               dir:
#                 type: string
#         bucket:
#           type: string
#         endpoint:
#           type: string
#         region:
#           type: string
#         dir:
#           type: string
#     s3:
#       type: object
#       properties:
#         access_key_id:
#           type: string
#         access_key_secret:
#           type: string
#         buckets:
#           type: array
#           items:
#             type: object
#         bucket:
#           type: string
#         region:
#           type: string
#         dir:
#           type: string
#     ftp:
#       type: object
#       properties:
#         path:
#           type: string
#         host:
#           type: string
#         port:
#           type: number
#         username:
#           type: string
#     email:
#       type: object
#       properties:
#         pop_server:
#           type: string
#         port:
#           type: number
#         email_address:
#           type: string
#         email_password:
#           type: string
#         detect_spam:
#           type: boolean
#     url:
#       type: object
#       properties:
#         url:
#           type: string
#         name:
#           type: string
#     feishu:
#       type: object
#       properties:
#         app_id:
#           type: string
#         app_secret:
#           type: string
#         space_id:
#           type: string
#         node_id:
#           type: string
#         method:
#           type: string
#         target_format:
#           type: string

collectionConfig:
  type: object
  properties:
    source:
      type: string
      description: Source system identifier
      example: "system"
    enable_vector:
      type: boolean
      description: Whether to enable vector index
      default: true
    enable_fulltext:
      type: boolean
      description: Whether to enable fulltext index
      default: true
    enable_knowledge_graph:
      type: boolean
      description: Whether to enable knowledge graph index
      default: true
    enable_summary:
      type: boolean
      description: Whether to enable summary index
      default: false
    enable_vision:
      type: boolean
      description: Whether to enable vision index
      default: false
    embedding:
      $ref: './model.yaml#/modelSpec'
      description: Embedding model configuration for vector indexing. Use /api/v1/available_models to get available models.
    completion:
      $ref: './model.yaml#/modelSpec'
      description: Completion model configuration for text generation. Use /api/v1/available_models to get available models.
    system:
      type: object
    object_storage:
      type: object
      description: Object storage source configuration (S3, MinIO, etc.)
      required:
        - endpoint
        - access_key
        - secret_key
        - bucket
      properties:
        endpoint:
          type: string
          description: Object storage endpoint URL
        access_key:
          type: string
          description: Access key for object storage authentication
        secret_key:
          type: string
          description: Secret key for object storage authentication
        enable_path_style:
          type: boolean
          description: Whether to use path-style URLs for object storage. Set to false for MinIO.
          default: false
        bucket:
          type: string
          description: Bucket name in object storage
        region:
          type: string
          description: Object storage region
        object_prefix:
          type: string
          description: Prefix for object keys to be included in the collection. Only objects with keys matching this prefix will be considered.
        include_filters:
          type: array
          description: Whitelist of complete object keys. Only objects with keys in this list will be included in the collection.
          items:
            type: string
            description: Complete object key to include
        exclude_filters:
          type: array
          description: Blacklist of complete object keys. Objects with keys in this list will be excluded from the collection. Takes precedence over include_filters if an object appears in both.
          items:
            type: string
            description: Complete object key to exclude
    anybase:
      type: object
      description: Anybase object storage source configuration. Endpoint, access_key, secret_key, bucket, and enable_path_style are configured via environment variables.
      properties:
        bucket:
          type: string
          description: Dynamic bucket.
        object_prefix:
          type: string
          description: Prefix for object keys to be included in the collection. Only objects with keys matching this prefix will be considered.
        include_filters:
          type: array
          description: Whitelist of complete object keys. Only objects with keys in this list will be included in the collection.
          items:
            type: string
            description: Complete object key to include
        exclude_filters:
          type: array
          description: Blacklist of complete object keys. Objects with keys in this list will be excluded from the collection. Takes precedence over include_filters if an object appears in both.
          items:
            type: string
            description: Complete object key to exclude

collectionCreate:
  type: object
  properties:
    title:
      type: string
    config:
      $ref: '#/collectionConfig'
    type:
      type: string
    description:
      type: string

collectionUpdate:
  type: object
  properties:
    title:
      type: string
    description:
      type: string
    config:
      $ref: '#/collectionConfig'

collection:
  description: Collection is a collection of documents
  properties:
    id:
      type: string
    title:
      type: string
    type:
      type: string
    description:
      type: string
    config:
      $ref: '#/collectionConfig'
    status:
      type: string
      enum:
        - ACTIVE
        - INACTIVE
        - DELETED
    created:
      type: string
      format: date-time
    updated:
      type: string
      format: date-time
    is_published:
      type: boolean
      description: Whether the collection is published to marketplace
      default: false
    published_at:
      type: string
      format: date-time
      nullable: true
      description: Publication time, null when not published

collectionView:
  type: object
  description: Lightweight collection information for lists, MCP and agents
  properties:
    id:
      type: string
    title:
      type: string
    description:
      type: string
    type:
      type: string
    config:
      $ref: '#/collectionConfig'
    status:
      type: string
      enum:
        - ACTIVE
        - INACTIVE
        - DELETED
    created:
      type: string
      format: date-time
    updated:
      type: string
      format: date-time
    is_published:
      type: boolean
      default: false
    published_at:
      type: string
      format: date-time
      nullable: true
      description: Publication time, null when not published
    owner_user_id:
      type: string
      description: Collection owner user ID
    owner_username:
      type: string
      nullable: true
      description: Collection owner username
    subscription_id:
      type: string
      nullable: true
      description: Subscription ID if this is a subscribed collection, null for owned collections
    subscribed_at:
      type: string
      format: date-time
      nullable: true
      description: Subscription time, null for owned collections

collectionViewList:
  type: object
  description: A list of collection views
  properties:
    items:
      type: array
      items:
        $ref: '#/collectionView'
    pageResult:
      $ref: './common.yaml#/pageResult'

collectionList:
  type: object
  description: A list of collections
  properties:
    items:
      type: array
      items:
        $ref: '#/collection'
    pageResult:
      $ref: './common.yaml#/pageResult'

vectorSearchParams:
  type: object
  properties:
    topk:
      type: integer
      description: Top K results
    similarity:
      type: number
      description: Similarity threshold
      minimum: 0
      maximum: 1

fulltextSearchParams:
  type: object
  properties:
    topk:
      type: integer
      description: Top K results
    keywords:
      type: array
      items:
        type: string
      description: Custom keywords to use for fulltext search

graphSearchParams:
  type: object
  properties:
    topk:
      type: integer
      description: Top K results

summarySearchParams:
  type: object
  properties:
    topk:
      type: integer
      description: Top K results
    similarity:
      type: number
      description: Similarity threshold
      minimum: 0
      maximum: 1

searchRequest:
  type: object
  description: Search request
  properties:
    query:
      type: string
    vector_search:
      $ref: '#/vectorSearchParams'
    fulltext_search:
      $ref: '#/fulltextSearchParams'
    graph_search:
      $ref: '#/graphSearchParams'
    summary_search:
      $ref: '#/summarySearchParams'
    save_to_history:
      type: boolean
      description: Whether to save search result to database history
      default: false
      example: true
    rerank:
      type: boolean
      description: Whether to enable rerank for search results
      default: false
      example: true

searchResultItem:
  type: object
  properties:
    rank:
      type: integer
      description: Result rank
    score:
      type: number
      description: Result score
    content:
      type: string
      description: Result content
    source:
      type: string
      description: Source document or metadata
    recall_type:
      type: string
      description: Recall type
      enum:
        - vector_search
        - graph_search
        - fulltext_search
        - summary_search
    metadata:
      type: object
      description: Metadata of the result

searchResult:
  type: object
  properties:
    id:
      type: string
      description: The id of the search result
    query:
      type: string
    vector_search:
      $ref: '#/vectorSearchParams'
    fulltext_search:
      $ref: '#/fulltextSearchParams'
    graph_search:
      $ref: '#/graphSearchParams'
    summary_search:
      $ref: '#/summarySearchParams'
    items:
      type: array
      items:
        $ref: '#/searchResultItem'
    created:
      type: string
      format: date-time
      description: The creation time of the search result

searchResultList:
  type: object
  description: A list of search results
  properties:
    items:
      type: array
      items:
        $ref: '#/searchResult'
